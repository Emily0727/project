<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ˜æ˜Ÿæ—¶åˆ» - ä½ çš„ä¸“å±ç²‰ä¸åœˆ</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
    }
    
    body {
      background-color: #f5f5f5;
      color: #333;
      line-height: 1.6;
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    
    header {
      text-align: center;
      margin-bottom: 30px;
      padding: 20px 0;
      background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
      border-radius: 10px;
      color: white;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    
    h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
    }
    
    .subtitle {
      font-size: 1.2rem;
      opacity: 0.9;
    }
    
    .post-form {
      background: white;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 30px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
    
    textarea {
      width: 100%;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 8px;
      resize: vertical;
      min-height: 100px;
      font-size: 1rem;
      margin-bottom: 15px;
    }
    
    button {
      background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 30px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: bold;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    
    button:disabled {
      background: #cccccc;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .posts {
      display: flex;
      flex-direction: column;
      gap: 25px;
    }
    
    .post {
      background: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      position: relative;
    }
    
    .post-content {
      margin-bottom: 15px;
      font-size: 1.1rem;
      line-height: 1.7;
    }
    
    .post-time {
      font-size: 0.8rem;
      color: #999;
      margin-bottom: 15px;
    }
    
    .comments {
      margin-top: 20px;
      border-top: 1px solid #eee;
      padding-top: 15px;
    }
    
    .comment {
      background: #f9f9f9;
      padding: 12px 15px;
      border-radius: 8px;
      margin-bottom: 10px;
      position: relative;
    }
    
    .comment:before {
      content: "â¤ï¸";
      position: absolute;
      left: -25px;
      top: 10px;
      font-size: 1.2rem;
    }
    
    .comment-author {
      font-weight: bold;
      color: #ff6b81;
      margin-bottom: 5px;
    }
    
    .loading {
      text-align: center;
      padding: 20px;
      color: #999;
    }
    
    .fans-count {
      position: absolute;
      top: 20px;
      right: 20px;
      background: #ff6b81;
      color: white;
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 0.8rem;
    }
    
    .error-message {
      color: #ff6b81;
      margin-top: 10px;
      text-align: center;
    }
    
    @media (max-width: 600px) {
      .container {
        padding: 10px;
      }
      
      header {
        padding: 15px 0;
      }
      
      h1 {
        font-size: 1.8rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>æ˜æ˜Ÿæ—¶åˆ»</h1>
      <p class="subtitle">ä½ çš„æ¯ä¸€åˆ»éƒ½å€¼å¾—è¢«èµç¾</p>
    </header>
    
    <div class="post-form">
      <h2>å‘å¸ƒä½ çš„åŠ¨æ€</h2>
      <textarea id="postContent" placeholder="ä»Šå¤©æœ‰ä»€ä¹ˆæƒ³åˆ†äº«çš„å—ï¼Ÿ"></textarea>
      <button id="postButton">å‘å¸ƒåŠ¨æ€</button>
      <div id="errorMessage" class="error-message"></div>
    </div>
    
    <div class="posts" id="postsContainer">
      <div class="loading">åŠ è½½ä¸­...</div>
    </div>
  </div>

  <script>
    // ä½¿ç”¨Gemini APIç”Ÿæˆèµç¾å›å¤
    const GEMINI_API_KEY = "AIzaSyAaELFaZFNagkYJxrcMeq6UBBbH4odYTmc";
    const GEMINI_ENDPOINT = `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${GEMINI_API_KEY}`;
    
    // å­˜å‚¨æ‰€æœ‰å¸–å­
    let posts = [];
    
    document.addEventListener('DOMContentLoaded', () => {
      const postButton = document.getElementById('postButton');
      const postContent = document.getElementById('postContent');
      const postsContainer = document.getElementById('postsContainer');
      const errorMessage = document.getElementById('errorMessage');
      
      // åŠ è½½ç¤ºä¾‹å¸–å­
      loadSamplePosts();
      
      postButton.addEventListener('click', async () => {
        const content = postContent.value.trim();
        if (!content) {
          showError("è¯·è¾“å…¥å†…å®¹åå†å‘å¸ƒ");
          return;
        }
        
        try {
          postButton.disabled = true;
          postButton.textContent = "å‘å¸ƒä¸­...";
          errorMessage.textContent = "";
          
          // åˆ›å»ºæ–°å¸–å­
          const newPost = {
            id: Date.now(),
            content: content,
            timestamp: new Date(),
            comments: [],
            fanCount: Math.floor(Math.random() * 9000) + 1000 // éšæœºç²‰ä¸æ•°
          };
          
          // æ·»åŠ åˆ°é¡µé¢
          addPostToDOM(newPost);
          posts.unshift(newPost);
          
          // æ¸…ç©ºè¾“å…¥æ¡†
          postContent.value = '';
          
          // ç”ŸæˆAIå›å¤ (3æ¡ä¸åŒçš„è¯„è®º)
          const comments = await Promise.all([
            generateFanComment(content),
            generateFanComment(content),
            generateFanComment(content)
          ]);
          
          newPost.comments = comments;
          
          // æ›´æ–°DOMæ˜¾ç¤ºè¯„è®º
          const postElement = document.getElementById(`post-${newPost.id}`);
          if (postElement) {
            const commentsContainer = postElement.querySelector('.comments');
            commentsContainer.innerHTML = '';
            
            comments.forEach(comment => {
              const commentElement = createCommentElement(comment);
              commentsContainer.appendChild(commentElement);
            });
          }
        } catch (error) {
          console.error('å‘å¸ƒå¤±è´¥:', error);
          showError("å‘å¸ƒå¤±è´¥ï¼Œè¯·ç¨åå†è¯•");
        } finally {
          postButton.disabled = false;
          postButton.textContent = "å‘å¸ƒåŠ¨æ€";
        }
      });
    });
    
    // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
    function showError(message) {
      const errorElement = document.getElementById('errorMessage');
      errorElement.textContent = message;
      setTimeout(() => {
        errorElement.textContent = "";
      }, 3000);
    }
    
    // æ·»åŠ å¸–å­åˆ°DOM
    function addPostToDOM(post) {
      const postsContainer = document.getElementById('postsContainer');
      const postElement = document.createElement('div');
      postElement.className = 'post';
      postElement.id = `post-${post.id}`;
      
      postElement.innerHTML = `
        <div class="fans-count">${post.fanCount.toLocaleString()}ä½ç²‰ä¸ä¸ºä½ ç‚¹èµ</div>
        <div class="post-content">${post.content}</div>
        <div class="post-time">${formatTime(post.timestamp)}</div>
        <div class="comments">
          <div class="loading">ç²‰ä¸ä»¬æ­£åœ¨èµ¶æ¥è¯„è®º...</div>
        </div>
      `;
      
      // ç§»é™¤"åŠ è½½ä¸­"æç¤ºå¦‚æœæ˜¯ç¬¬ä¸€ä¸ªå¸–å­
      if (postsContainer.querySelector('.loading')) {
        postsContainer.innerHTML = '';
      }
      
      postsContainer.prepend(postElement);
    }
    
    // æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤º
    function formatTime(date) {
      const now = new Date();
      const diff = now - date;
      
      if (diff < 60000) return "åˆšåˆš";
      if (diff < 3600000) return `${Math.floor(diff / 60000)}åˆ†é’Ÿå‰`;
      if (diff < 86400000) return `${Math.floor(diff / 3600000)}å°æ—¶å‰`;
      return `${Math.floor(diff / 86400000)}å¤©å‰`;
    }
    
    // åˆ›å»ºè¯„è®ºå…ƒç´ 
    function createCommentElement(comment) {
      const commentElement = document.createElement('div');
      commentElement.className = 'comment';
      commentElement.innerHTML = `
        <div class="comment-author">${comment.author}</div>
        <div class="comment-text">${comment.text}</div>
      `;
      return commentElement;
    }
    
    // ç”Ÿæˆç²‰ä¸è¯„è®º
    async function generateFanComment(postContent) {
      try {
        // æ¨¡æ‹Ÿä¸åŒçš„ç²‰ä¸åç§°
        const fanNames = [
          "å¿ å®ç²‰ä¸", "å°è¿·å¦¹", "é“æ†ç²‰ä¸", "çœŸçˆ±ç²‰", 
          "æ˜Ÿæ˜Ÿçœ¼", "å¤´å·ç²‰ä¸", "é»˜é»˜æ”¯æŒ", "æ°¸è¿œè¿½éš",
          "ä½ çš„å°å¤ªé˜³", "ä¸ºä½ æ‰“call", "å¿ƒåŠ¨ç¬é—´", "ä¸ºä½ è€Œæ¥",
          "è¶…çº§ç²‰ä¸", "å°è¿·å¼Ÿ", "æ°¸è¿œæ”¯æŒ", "ä½ çš„ç²‰ä¸"
        ];
        
        // ä½¿ç”¨Gemini APIç”Ÿæˆåˆ›æ„å›å¤
        const response = await fetch(GEMINI_ENDPOINT, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            contents: [{
              parts: [{
                text: `ä½ æ˜¯ä¸€ä¸ªçƒ­æƒ…æ´‹æº¢çš„ç²‰ä¸ï¼Œéœ€è¦ç”¨å……æ»¡åˆ›æ„çš„æ–¹å¼èµç¾æ˜æ˜Ÿçš„åŠ¨æ€ã€‚å›å¤è¦:
1. ç®€çŸ­æœ‰åŠ› (20å­—ä»¥å†…)
2. å……æ»¡çƒ­æƒ…å’Œæ­£èƒ½é‡
3. æ ¹æ®å†…å®¹æ‰¾åˆ°ç‹¬ç‰¹è§’åº¦èµç¾
4. é¿å…é‡å¤å’Œåƒç¯‡ä¸€å¾‹
5. ä½¿ç”¨emojiå¢åŠ æ´»åŠ›
                
æ˜æ˜Ÿå‘å¸ƒäº†: "${postContent}"
è¯·ç”¨ç²‰ä¸è¯­æ°”å†™ä¸€æ¡çƒ­æƒ…æ´‹æº¢çš„è¯„è®º`
              }]
            }]
          })
        });
        
        const data = await response.json();
        const commentText = data.candidates?.[0]?.content?.parts?.[0]?.text || "å¤ªæ£’äº†ï¼è¿™å°±æ˜¯æˆ‘å–œæ¬¢ä½ çš„åŸå› ï¼â¤ï¸";
        
        return {
          author: fanNames[Math.floor(Math.random() * fanNames.length)],
          text: commentText.trim()
        };
      } catch (error) {
        console.error('ç”Ÿæˆè¯„è®ºå¤±è´¥:', error);
        // è¿”å›å¤‡ç”¨è¯„è®º
        return {
          author: "å¿ å®ç²‰ä¸",
          text: "å¤ªæ£’äº†ï¼è¿™å°±æ˜¯æˆ‘å–œæ¬¢ä½ çš„åŸå› ï¼â¤ï¸"
        };
      }
    }
    
    // åŠ è½½ç¤ºä¾‹å¸–å­
    function loadSamplePosts() {
      const samplePosts = [
        {
          id: 1,
          content: "ä»Šå¤©å¤©æ°”çœŸå¥½ï¼Œå‡ºå»æ•£æ­¥äº†~",
          timestamp: new Date(),
          fanCount: 5234,
          comments: [
            { author: "é˜³å…‰å°ç²‰ä¸", text: "èƒ½å’Œä½ åœ¨åŒä¸€å¤©äº«å—é˜³å…‰çœŸæ˜¯å¤ªå¹¸ç¦äº†ï¼â˜€ï¸" },
            { author: "æ•£æ­¥çˆ±å¥½è€…", text: "ä½ æ•£æ­¥çš„æ ·å­ä¸€å®šå¾ˆç¾ï¼Œç¾¡æ…•é‚£äº›èƒ½å¶é‡ä½ çš„äººï¼ğŸ’–" },
            { author: "å¤©æ°”è§‚å¯Ÿå‘˜", text: "è¿å¤©æ°”éƒ½ä¸ºä½ å˜å¾—ç¾å¥½ï¼Œè¿™å°±æ˜¯æ˜æ˜Ÿæ•ˆåº”å§ï¼âœ¨" }
          ]
        },
        {
          id: 2,
          content: "å°è¯•åšäº†æ–°èœï¼Œå‘³é“è¿˜ä¸é”™ï¼",
          timestamp: new Date(Date.now() - 3600000),
          fanCount: 7891,
          comments: [
            { author: "ç¾é£Ÿä¾¦æ¢", text: "ä½ åšçš„èœä¸€å®šè‰²é¦™å‘³ä¿±å…¨ï¼Œå¥½æƒ³å°ä¸€å£ï¼ğŸ´" },
            { author: "å¨æˆ¿å°ç™½", text: "è¿åšèœéƒ½è¿™ä¹ˆæœ‰å¤©èµ‹ï¼Œä¸æ„§æ˜¯å…¨èƒ½å¶åƒï¼ğŸ‘‘" },
            { author: "åƒè´§ä¸€æš", text: "çœ‹ç€ä½ çš„æè¿°å°±æµå£æ°´äº†ï¼Œè¿™å°±æ˜¯å¶åƒçš„é­…åŠ›å—ï¼ŸğŸ˜‹" }
          ]
        }
      ];
      
      posts = samplePosts;
      
      // å»¶è¿ŸåŠ è½½æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚
      setTimeout(() => {
        const postsContainer = document.getElementById('postsContainer');
        postsContainer.innerHTML = '';
        
        samplePosts.forEach(post => {
          addPostToDOM(post);
          
          // æ˜¾ç¤ºè¯„è®º
          const postElement = document.getElementById(`post-${post.id}`);
          if (postElement) {
            const commentsContainer = postElement.querySelector('.comments');
            commentsContainer.innerHTML = '';
            
            post.comments.forEach(comment => {
              const commentElement = createCommentElement(comment);
              commentsContainer.appendChild(commentElement);
            });
          }
        });
      }, 1000);
    }
  </script>
</body>
</html>